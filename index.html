<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hifz Post Generator - Full Version</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Aref+Ruqaa:wght@400;700&family=Cairo:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Amiri', serif; background: #1a1a2e; color: #ecf0f1; margin: 0; padding: 20px; display: flex; flex-direction: row; gap: 30px; justify-content: center; }
        .editor-panel { background: #ffffff; color: #2c3e50; padding: 25px; border-radius: 15px; width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-top: 8px solid #d4af37; height: 95vh; overflow-y: auto; }
        h2 { font-family: 'Aref Ruqaa', serif; text-align: center; color: #1a5276; margin-top: 0; }
        .field { margin-bottom: 12px; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; }
        label { display: block; font-size: 0.8em; font-weight: bold; margin-bottom: 4px; color: #34495e; }
        input[type="text"], select, input[type="file"], input[type="range"], input[type="color"] { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #bdc3c7; box-sizing: border-box; font-family: 'Amiri'; }
        input[type="color"] { height: 40px; cursor: pointer; padding: 2px; }
        canvas { border: 10px solid #fff; box-shadow: 0 15px 45px rgba(0,0,0,0.4); max-width: 550px; height: auto; background: #2c3e50; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Aref Ruqaa'; font-weight: bold; background: #27ae60; color: white; font-size: 1.1em; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="editor-panel">
        <h2>Post Editor</h2>
        
        <div class="field">
            <label>1. Select Marhala</label>
            <select id="templateSelect" onchange="updateBackground()">
                <option value="">-- Select Marhalah --</option>
                <option value="https://lh3.googleusercontent.com/u/0/d/1GKTveSxVxRpu1eEWxFZmNj4uBc5Vd35N">Marhala 1</option>
                <option value="https://lh3.googleusercontent.com/d/119wOoByVcSf5t7OTz9cKasOsf8wKCGw7">Marhala 2</option>
                <option value="https://lh3.googleusercontent.com/d/1S1MWEdOAWY5zGUxFwJudxPIzJej7g-YH">Marhala 3</option>
                <option value="https://lh3.googleusercontent.com/d/19SVxCq61K-h7IL-1zABNaJWi1TLkvufb">Marhala 4</option>
                <option value="https://lh3.googleusercontent.com/d/1bv9EYm9aYMo_F3fPT4atEQFXdd8nAtE5">Marhala 5</option>
                <option value="https://lh3.googleusercontent.com/d/10szobf_63M0WK2iHRgYn77TN08UBQ6Rl">Marhala 6</option>
                <option value="https://lh3.googleusercontent.com/d/1x3V47k1Hq_dzsToYQxyWRb8lPjD_X4TD">Marhala 7</option>
                <option value="https://lh3.googleusercontent.com/d/1cDodMK52jBwrZErQHRE2d9_imyGNR--L">Marhala 8</option>
            </select>
        </div>

        <div class="field">
            <label>2. Institute Location</label>
            <select id="instName">
                <option value="">-- Select Location --</option>
                <option value="قسم التحفيظ - جمالي محلة">جمالي محلة</option>
                <option value="قسم التحفيظ - المحلة البرهانية">المحلة البرهانية</option>
                <option value="قسم التحفيظ - برهاني باغ محلة">برهاني باغ محلة</option>
                <option value="قسم التحفيظ - المحلة الفخرية">المحلة الفخرية</option>
                <option value="قسم التحفيظ - المحلة المحمدية">المحلة المحمدية</option>
                <option value="قسم التحفيظ - عزي محلة">عزي محلة</option>
                <option value="قسم التحفيظ - طاهري محلة">طاهري محلة</option>
                <option value="قسم التحفيظ - محمدي محلة">محمدي محلة</option>
                <option value="قسم التحفيظ - صالح محلة">صالح محلة</option>
                <option value="قسم التحفيظ - اْدم محلة">اْدم محلة</option>
                <option value="قسم التحفيظ - عيسى محلة">عيسى محلة</option>
                <option value="قسم التحفيظ - سيفي محلة">سيفي محلة</option>
                <option value="قسم التحفيظ - ابراهيم محلة">ابراهيم محلة</option>
                <option value="قسم التحفيظ - يوسفي محلة">يوسفي محلة</option>
                <option value="قسم التحفيظ - برهاني محلة">برهاني محلة</option>
                <option value="قسم التحفيظ - قطبي محلة">قطبي محلة</option>
                <option value="قسم التحفيظ - حسني محلة">حسني محلة</option>
                <option value="قسم التحفيظ - حسيني محلة">حسيني محلة</option>
                <option value="قسم التحفيظ - برهاني نككر">برهاني نككر</option>
                <option value="قسم التحفيظ - بدري محلة">بدري محلة</option>
                <option value="قسم التحفيظ - ملتان">ملتان</option>
                <option value="قسم التحفيظ - لاهور">لاهور</option>
                <option value="قسم التحفيظ - ايبطاباد">ايبطاباد</option>
                <option value="قسم التحفيظ - راولثثندي">راولثثندي</option>
                <option value="قسم التحفيظ - كوئطه">كوئطه</option>
            </select>
        </div>

        <div class="field">
            <label>3. Typography (Names Only)</label>
            <select id="fontSelect">
                <option value="Amiri">Amiri (Default)</option>
                <option value="Aref Ruqaa">Aref Ruqaa</option>
                <option value="Cairo">Cairo</option>
                <option value="Tajawal">Tajawal</option>
            </select>
            <label style="font-size: 0.7em; margin-top:5px;">Color for Student Names</label>
            <input type="color" id="nameColor" value="#1a5276">
        </div>

        <div class="field">
            <label>4. Student Details</label>
            <input type="text" id="stdFirstName" placeholder="First Name">
            <input type="text" id="stdFatherName" placeholder="Father Name">
            <input type="text" id="stdSurname" placeholder="Surname">
            <input type="text" id="stdAge" placeholder="Age">
        </div>

        <div class="field">
            <label>5. Day & Dates</label>
            <select id="dayArabic">
                <option value="">-- Day --</option>
                <option value="يوم السبت">يوم السبت</option>
                <option value="يوم الأحد">يوم الأحد</option>
                <option value="يوم الإثنين">يوم الإثنين</option>
                <option value="يوم الثلاثاء">يوم الثلاثاء</option>
                <option value="يوم الأربعاء">يوم الأربعاء</option>
                <option value="يوم الخميس">يوم الخميس</option>
                <option value="يوم الجمعة">يوم الجمعة</option>
            </select>
            <input type="text" id="dateHijri" placeholder="Hijri Date">
            <input type="text" id="dateGreg" placeholder="Gregorian Date">
        </div>

        <div class="field">
            <label>6. Photo Controls</label>
            <input type="file" id="studentUpload" accept="image/*">
            <input type="range" id="photoZoom" min="0.5" max="3.0" step="0.1" value="1">
            <input type="range" id="photoYOffset" min="-500" max="500" value="0">
        </div>

        <button onclick="download()">Download PNG</button>
    </div>

    <div class="preview-container">
        <canvas id="canvas" width="1224" height="1776"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let bgImage = new Image();
        let studentImage = null;

        const POS = {
            inst: { x: 612, y: 380, maxWidth: 850 },
            photo: { x: 900, y: 740, radius: 195 },
            nameFirst: { x: 630, y: 650, maxWidth: 450 },
            nameFull: { x: 630, y: 750, maxWidth: 450 },
            age: { x: 630, y: 850 },
            dateX: 890,
            dateH_Y: 1310,
            dateG_Y: 1380
        };

        const staticFont = "Amiri"; 

        const controls = ['instName', 'stdFirstName', 'nameColor', 'stdFatherName', 'stdSurname', 'stdAge', 'dateHijri', 'dateGreg', 'photoZoom', 'photoYOffset', 'fontSelect', 'dayArabic'];
        controls.forEach(id => document.getElementById(id).addEventListener('input', draw));

        function drawText(text, x, y, maxWidth, baseSize, font, isBold, color, align='right') {
            if (!text) return;
            let size = baseSize;
            ctx.textAlign = align;
            ctx.fillStyle = color;
            ctx.font = `${isBold ? 'bold' : ''} ${size}px "${font}"`;
            while (ctx.measureText(text).width > maxWidth && size > 12) {
                size--;
                ctx.font = `${isBold ? 'bold' : ''} ${size}px "${font}"`;
            }
            ctx.fillText(text, x, y);
        }

        function draw() {
            const studentFont = document.getElementById('fontSelect').value;
            const chosenColor = document.getElementById('nameColor').value;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (bgImage.complete && bgImage.src) ctx.drawImage(bgImage, 0, 0, 1224, 1776);

            // 1. Institute (Static Font - Glow)
            ctx.save();
            ctx.direction = 'rtl';
            ctx.shadowColor = '#00d4ff'; ctx.shadowBlur = 15;
            drawText(document.getElementById('instName').value, POS.inst.x, POS.inst.y, POS.inst.maxWidth, 75, staticFont, true, '#e8f6ff', 'center');
            ctx.restore();

            // 2. Photo
            if (studentImage) {
                ctx.save();
                ctx.beginPath(); ctx.arc(POS.photo.x, POS.photo.y, POS.photo.radius, 0, Math.PI * 2); ctx.clip();
                const zoom = parseFloat(document.getElementById('photoZoom').value);
                const yOff = parseFloat(document.getElementById('photoYOffset').value);
                const ratio = Math.max((POS.photo.radius*2) / studentImage.width, (POS.photo.radius*2) / studentImage.height) * zoom;
                ctx.drawImage(studentImage, POS.photo.x - (studentImage.width*ratio/2), POS.photo.y - (studentImage.height*ratio/2) + yOff, studentImage.width*ratio, studentImage.height*ratio);
                ctx.restore();
            }

            // 3. Names (STUDENT SELECTED FONT & COLOR)
            ctx.save();
            ctx.direction = 'rtl';
            ctx.shadowColor = 'rgba(0,0,0,0.3)'; ctx.shadowBlur = 5; ctx.shadowOffsetY = 3;
            drawText(document.getElementById('stdFirstName').value, POS.nameFirst.x, POS.nameFirst.y, POS.nameFirst.maxWidth, 75, studentFont, true, chosenColor);
            const fullNameLine = document.getElementById('stdFatherName').value + " " + document.getElementById('stdSurname').value;
            drawText(fullNameLine, POS.nameFull.x, POS.nameFull.y, POS.nameFull.maxWidth, 50, studentFont, false, chosenColor);

            // 4. Age (Static Font)
            const ageText = document.getElementById('stdAge').value;
            if(ageText) {
                ctx.font = `42px "${staticFont}"`;
                ctx.fillStyle = '#1a5276'; 
                ctx.fillText(ageText + " ورس", POS.age.x, POS.age.y);
            }
            ctx.restore();

            // 5. Dates (Static Font)
            ctx.fillStyle = '#e8f6ff';
            ctx.direction = 'rtl';
            const hijriLine = document.getElementById('dateHijri').value + (document.getElementById('dayArabic').value ? "، " + document.getElementById('dayArabic').value : "");
            drawText(hijriLine, POS.dateX, POS.dateH_Y, 600, 55, staticFont, false, '#e8f6ff', 'right');

            ctx.direction = 'ltr';
            drawText(document.getElementById('dateGreg').value, POS.dateX, POS.dateG_Y, 600, 42, staticFont, false, '#e8f6ff', 'right');
        }

        function updateBackground() {
            const url = document.getElementById('templateSelect').value;
            if(url) { bgImage.crossOrigin = "anonymous"; bgImage.src = url; bgImage.onload = draw; }
        }

        document.getElementById('studentUpload').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (f) => { studentImage = new Image(); studentImage.onload = draw; studentImage.src = f.target.result; };
            reader.readAsDataURL(e.target.files[0]);
        };

        function download() {
            const link = document.createElement('a');
            link.download = 'Hifz_Post.png';
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
        }
    </script>
</body>
</html>
